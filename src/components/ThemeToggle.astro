---
/**
 * ThemeToggle
 * - No-param functions only
 * - No function calls with arguments (avoids ts(2554))
 * - No implicit-any params (avoids ts(7006))
 */
const label = "Toggle theme";
---

<button
  id="nw-theme-toggle"
  type="button"
  class="button theme-toggle"
  aria-label={label}
  title={label}
>
  <span class="sr-only">Toggle theme</span>

  <span aria-hidden="true">ğŸŒ“</span>
</button>

<script>
  const KEY = "nw:theme";
  const root = document.documentElement;

  function getStored() {
    try {
      const v = localStorage.getItem(KEY);
      return v === "dark" ? "dark" : (v === "light" ? "light" : null);
    } catch {
      return null;
    }
  }

  function getPreferred() {
    try {
      return (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches)
        ? "dark"
        : "light";
    } catch {
      return "light";
    }
  }

  function getCurrentFromDom() {
    const v = root.dataset.theme;
    return v === "dark" ? "dark" : (v === "light" ? "light" : null);
  }

  function applyTheme() {
    const dom = getCurrentFromDom();
    const stored = getStored();
    const next = dom || stored || getPreferred();

    root.dataset.theme = next;
    root.classList.toggle("theme-dark", next === "dark");
  }

  function flipTheme() {
    const dom = getCurrentFromDom();
    const stored = getStored();
    const cur = dom || stored || getPreferred();
    const next = (cur === "dark") ? "light" : "dark";

    root.dataset.theme = next;
    root.classList.toggle("theme-dark", next === "dark");

    try { localStorage.setItem(KEY, next); } catch { /* noop */ }
  }

  applyTheme();

  const btn = document.getElementById("nw-theme-toggle");
  if (btn) btn.addEventListener("click", flipTheme);

  try {
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    if (mq && mq.addEventListener) {
      mq.addEventListener("change", function () {
        // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù… ÙŠØ«Ø¨Øª theme ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†ØŒ Ø§ØªØ¨Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…
        if (!getStored()) applyTheme();
      });
    }
  } catch { /* noop */ }
</script>
