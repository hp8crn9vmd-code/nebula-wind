---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from 'astro:content';

type BlogEntry = CollectionEntry<'blog'>;

const posts: BlogEntry[] = (await getCollection('blog'))
  .filter((p: BlogEntry) => !p.data.draft)
  .sort((a: BlogEntry, b: BlogEntry) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<BaseLayout
  title="Blog â€” NebulaWind"
  description="NebulaWind Blog: clean-room updates, architecture notes, and production-ready patterns."
>
  <main class="min-h-screen">
    <div class="max-w-5xl mx-auto px-5 py-16">
      <div class="flex items-end justify-between gap-4">
        <h1 class="text-4xl font-semibold tracking-tight">Blog</h1>
        <div class="flex gap-3 text-sm">
          <a class="text-white/70 hover:text-white" href="/">Home</a>
          <a class="text-white/70 hover:text-white" href="/search/">Search</a>
        </div>
      </div>

      <p class="mt-3 text-white/70">
        Type-safe posts powered by Astro Content Collections.
      </p>

      <div class="mt-10 space-y-4">
        {posts.map((post: BlogEntry) => (
          <article class="p-5 rounded-nw border border-white/10 bg-white/5">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <h2 class="text-xl font-semibold">
                <a class="hover:underline" href={`/blog/${post.slug}/`}>{post.data.title}</a>
              </h2>
              <time class="text-sm text-white/60">
                {post.data.publishDate.toISOString().slice(0, 10)}
              </time>
            </div>
            <p class="mt-2 text-white/75">{post.data.description}</p>

            {post.data.tags.length > 0 && (
              <ul class="mt-3 flex flex-wrap gap-2">
                {post.data.tags.map((t: string) => (
                  <li class="text-xs px-2 py-1 rounded-full border border-white/10 text-white/70">
                    {t}
                  </li>
                ))}
              </ul>
            )}
          </article>
        ))}
      </div>
    </div>
  </main>
</BaseLayout>
